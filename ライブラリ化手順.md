# ライブラリ化手順

### EclipseADTからプロジェクトのインポート
1. AndroidStudioから[File]->[Import Project...]を選択する。
2. インポートするEclipseADTプロジェクトを選択する。
3. AndroidStudioのプロジェクトが作成されます。

### build.gradleの編集
1. [プロジェクト名]\app\build.gradleを編集する。
2. build.gradleの記述例を以下に示します。

build.gradle

    buildscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            // gradleのバージョンを明示的に宣言します
            classpath 'com.android.tools.build:gradle:1.0.1'
        }
    }

    // ライブラリとしてビルドする場合に必要な記述方法です
    apply plugin: 'com.android.library'

    android {
        compileSdkVersion 21
        buildToolsVersion "21.1.2"

        defaultConfig {
            minSdkVersion 14
            targetSdkVersion 21
        }

        buildTypes {
            release {
                minifyEnabled false
                proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
            }
        }
    }

    // 本ライブラリに必要な依存関係を書いておきます
    dependencies {
        compile 'com.android.support:support-v4:21.0.3'
        compile 'com.google.android.gms:play-services:+'
    }

    // 以下は特定バージョンのaarファイルを作成するに必要な記述方法です
    // (注1)アプリ側でaarを読む場合にここにある記述に従って取得します
    // 'グループid:アーティファクトid:バージョン@aar'
    // 'jp.co.jokerpiece.android.piececore:android.piececore:0.0.4@aar'
    // (注2)同じバージョンでライブラリを更新しても更新内容が反映されませんでした
    // ライブラリを更新する場合はバージョンを上げる必要がある(??)
    // 現状はライブラリを更新する場合はバージョンを上げて対応しています
    // (注3)aarを作成すると、"strings.xml, styles.xml, dimens.xml, colors.xml"は
    // values.xmlとして統合されます
    apply plugin: 'maven'

    uploadArchives {
        repositories {
            mavenDeployer {
                // 作成したaarファイルを保存する場所を記述します
                repository url: "file://${projectDir}/repository"
                // グループid
                pom.groupId = 'jp.co.jokerpiece.android.piececore'
                // アーティファクトid
                pom.artifactId = 'android.piececore'
                // バージョン
                pom.version = '0.0.4'
            }
        }
    }

### AndroidManifest.xmlの編集
1. [プロジェクト名]\app\src\main\AndroidManifest.xmlを編集する。
2. AndroidManifest.xmlの記述例を以下に示します。

AndroidManifest.xml

    <?xml version="1.0" encoding="utf-8"?>
    <manifest xmlns:android="http://schemas.android.com/apk/res/android"
        package="jp.co.jokerpiece.piecebase"
        android:versionCode="1"
        android:versionName="1.0.0" >

        <uses-sdk
            android:minSdkVersion="14"
            android:targetSdkVersion="21" />

        <!-- applicationの中身はライブラリ側は簡素化しておく -->
        <!-- アプリ側で使用するパーミッション、アクティビティを宣言する -->
        <application />

    </manifest>

### ライブラリの作成
1. ![Sync Project](./syncProj.png)ボタンを押下でビルドを実行する。
2. Terminalで「gradlew uploadArchives」を実行する。
3. [プロジェクト名]\app\repositoryにライブラリができている。

### ライブラリをgithubに登録
0. プロジェクト名をandroid.PieceCoreである場合を記述します。
1. android.PieceCoreプロジェクトが存在するフォルダ内に移動する。
2. 「git init」を実行する。
3. 「git add android.PieceCore」を実行する。
4. 「git commit -m "android.PieceCoreプロジェクトのコミット。"」を実行する。
5. 「git remote add origin git@github.com:jokerpiece/android.PieceCore.git」を実行する。
6. 「git push origin master」を実行する。
7. android.PieceCoreプロジェクトがgithubに登録されている。

### 参考にしたホームページ
* Androidの自作ライブラリの公開手順まとめ<br>(<http://qiita.com/taisho6339/items/ac802c13c1409ff33fd7#%E6%A6%82%E8%A6%81>)
* Hosting a Maven repository on github<br>(<http://stackoverflow.com/questions/14013644/hosting-a-maven-repository-on-github>)

